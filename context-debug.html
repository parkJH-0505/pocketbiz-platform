<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Debug Tool</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #0078d4;
            color: white;
        }
        .btn:hover {
            background: #106ebe;
        }
        .output {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            border: 1px solid #3c3c3c;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 Context Debug Tool</h1>
        <p>앱과 동일한 도메인에서 실행해야 합니다: http://localhost:5174</p>

        <div class="section">
            <h2>📊 Context 상태 확인</h2>
            <button class="btn" onclick="checkContexts()">Context 상태 확인</button>
            <button class="btn" onclick="checkMethods()">메서드 확인</button>
            <button class="btn" onclick="testCreateSchedule()">createSchedule 테스트</button>
            <button class="btn" onclick="clearOutput()">출력 초기화</button>
            <div id="output" class="output"></div>
        </div>

        <div class="section">
            <h2>🧪 빠른 테스트</h2>
            <button class="btn" onclick="runUnitTest()">단위 테스트 실행</button>
            <button class="btn" onclick="runScenarioTest()">시나리오 테스트 실행</button>
        </div>
    </div>

    <script>
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            let className = type;
            let prefix = '';

            if (type === 'success') prefix = '✅ ';
            else if (type === 'error') prefix = '❌ ';
            else if (type === 'warning') prefix = '⚠️  ';
            else if (type === 'info') prefix = 'ℹ️  ';

            output.innerHTML += `<span class="${className}">[${timestamp}] ${prefix}${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            output.innerHTML = '';
        }

        function checkContexts() {
            log('Context 상태 확인 시작...', 'info');

            // BuildupContext 확인
            const buildupContext = window.buildupContext;
            log(`BuildupContext 존재: ${!!buildupContext}`, buildupContext ? 'success' : 'error');

            if (buildupContext) {
                log(`  - projects: ${buildupContext.projects?.length || 0}개`, 'info');
                log(`  - executePhaseTransition: ${typeof buildupContext.executePhaseTransition}`, 'info');
                log(`  - setProjects: ${typeof buildupContext.setProjects}`, 'info');
            }

            // ScheduleContext 확인
            const scheduleContext = window.scheduleContext;
            log(`ScheduleContext 존재: ${!!scheduleContext}`, scheduleContext ? 'success' : 'error');

            if (scheduleContext) {
                log(`  - schedules: ${scheduleContext.schedules?.length || 0}개`, 'info');
                log(`  - createSchedule: ${typeof scheduleContext.createSchedule}`, 'info');
                log(`  - updateSchedule: ${typeof scheduleContext.updateSchedule}`, 'info');
                log(`  - isLoading: ${scheduleContext.isLoading}`, 'info');
                log(`  - error: ${scheduleContext.error}`, 'info');
            }

            // Sprint5Tests 확인
            const sprint5Tests = window.sprint5Tests;
            log(`Sprint5Tests 존재: ${!!sprint5Tests}`, sprint5Tests ? 'success' : 'error');

            if (sprint5Tests) {
                log(`  - unitTests: ${!!sprint5Tests.unitTests}`, 'info');
                log(`  - scenarioTests: ${!!sprint5Tests.scenarioTests}`, 'info');
                log(`  - runAll: ${typeof sprint5Tests.runAll}`, 'info');
            }
        }

        function checkMethods() {
            log('메서드 상세 확인...', 'info');

            const scheduleContext = window.scheduleContext;
            if (scheduleContext) {
                const methods = Object.keys(scheduleContext).filter(key => typeof scheduleContext[key] === 'function');
                log(`ScheduleContext 메서드들: ${methods.join(', ')}`, 'info');

                // createSchedule 파라미터 확인
                if (scheduleContext.createSchedule) {
                    log(`createSchedule 함수 길이: ${scheduleContext.createSchedule.length} 파라미터`, 'info');
                }
            }

            const buildupContext = window.buildupContext;
            if (buildupContext) {
                const methods = Object.keys(buildupContext).filter(key => typeof buildupContext[key] === 'function');
                log(`BuildupContext 메서드들: ${methods.join(', ')}`, 'info');
            }
        }

        async function testCreateSchedule() {
            log('createSchedule 직접 테스트...', 'info');

            const scheduleContext = window.scheduleContext;
            if (!scheduleContext || !scheduleContext.createSchedule) {
                log('createSchedule 메서드를 찾을 수 없습니다', 'error');
                return;
            }

            try {
                log('테스트 미팅 생성 시도...', 'info');
                const testMeeting = await scheduleContext.createSchedule({
                    type: 'buildup_project',
                    title: '[Debug] Context Test Meeting',
                    description: 'Context debug tool 테스트',
                    date: new Date(Date.now() + 60000),
                    startDateTime: new Date(Date.now() + 60000),
                    endDateTime: new Date(Date.now() + 120000),
                    projectId: 'PRJ-TEST',
                    meetingSequence: 'pre_meeting',
                    location: 'Debug Room'
                });

                log(`미팅 생성 성공: ${testMeeting.id}`, 'success');
                log(`스케줄 총 개수: ${scheduleContext.schedules?.length || 0}`, 'info');

            } catch (error) {
                log(`미팅 생성 실패: ${error.message}`, 'error');
                log(`전체 오류: ${JSON.stringify(error, null, 2)}`, 'error');
            }
        }

        async function runUnitTest() {
            log('단위 테스트 실행...', 'info');

            if (window.sprint5Tests && window.sprint5Tests.unitTests) {
                try {
                    const result = await window.sprint5Tests.unitTests.meetingCreation();
                    log(`단위 테스트 결과: ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'error');
                } catch (error) {
                    log(`단위 테스트 오류: ${error.message}`, 'error');
                }
            } else {
                log('sprint5Tests.unitTests를 찾을 수 없습니다', 'error');
            }
        }

        async function runScenarioTest() {
            log('시나리오 테스트 실행...', 'info');

            if (window.sprint5Tests && window.sprint5Tests.scenarioTests) {
                try {
                    const result = await window.sprint5Tests.scenarioTests.basicMeetingToPhase();
                    log(`시나리오 테스트 결과: ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'error');
                } catch (error) {
                    log(`시나리오 테스트 오류: ${error.message}`, 'error');
                }
            } else {
                log('sprint5Tests.scenarioTests를 찾을 수 없습니다', 'error');
            }
        }

        // 페이지 로드 시 자동으로 상태 확인
        window.onload = () => {
            setTimeout(checkContexts, 1000);
        };
    </script>
</body>
</html>