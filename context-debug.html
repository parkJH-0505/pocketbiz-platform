<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Debug Tool</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #0078d4;
            color: white;
        }
        .btn:hover {
            background: #106ebe;
        }
        .output {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            border: 1px solid #3c3c3c;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Context Debug Tool</h1>
        <p>ì•±ê³¼ ë™ì¼í•œ ë„ë©”ì¸ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤: http://localhost:5174</p>

        <div class="section">
            <h2>ğŸ“Š Context ìƒíƒœ í™•ì¸</h2>
            <button class="btn" onclick="checkContexts()">Context ìƒíƒœ í™•ì¸</button>
            <button class="btn" onclick="checkMethods()">ë©”ì„œë“œ í™•ì¸</button>
            <button class="btn" onclick="testCreateSchedule()">createSchedule í…ŒìŠ¤íŠ¸</button>
            <button class="btn" onclick="clearOutput()">ì¶œë ¥ ì´ˆê¸°í™”</button>
            <div id="output" class="output"></div>
        </div>

        <div class="section">
            <h2>ğŸ§ª ë¹ ë¥¸ í…ŒìŠ¤íŠ¸</h2>
            <button class="btn" onclick="runUnitTest()">ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="btn" onclick="runScenarioTest()">ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        </div>
    </div>

    <script>
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            let className = type;
            let prefix = '';

            if (type === 'success') prefix = 'âœ… ';
            else if (type === 'error') prefix = 'âŒ ';
            else if (type === 'warning') prefix = 'âš ï¸  ';
            else if (type === 'info') prefix = 'â„¹ï¸  ';

            output.innerHTML += `<span class="${className}">[${timestamp}] ${prefix}${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            output.innerHTML = '';
        }

        function checkContexts() {
            log('Context ìƒíƒœ í™•ì¸ ì‹œì‘...', 'info');

            // BuildupContext í™•ì¸
            const buildupContext = window.buildupContext;
            log(`BuildupContext ì¡´ì¬: ${!!buildupContext}`, buildupContext ? 'success' : 'error');

            if (buildupContext) {
                log(`  - projects: ${buildupContext.projects?.length || 0}ê°œ`, 'info');
                log(`  - executePhaseTransition: ${typeof buildupContext.executePhaseTransition}`, 'info');
                log(`  - setProjects: ${typeof buildupContext.setProjects}`, 'info');
            }

            // ScheduleContext í™•ì¸
            const scheduleContext = window.scheduleContext;
            log(`ScheduleContext ì¡´ì¬: ${!!scheduleContext}`, scheduleContext ? 'success' : 'error');

            if (scheduleContext) {
                log(`  - schedules: ${scheduleContext.schedules?.length || 0}ê°œ`, 'info');
                log(`  - createSchedule: ${typeof scheduleContext.createSchedule}`, 'info');
                log(`  - updateSchedule: ${typeof scheduleContext.updateSchedule}`, 'info');
                log(`  - isLoading: ${scheduleContext.isLoading}`, 'info');
                log(`  - error: ${scheduleContext.error}`, 'info');
            }

            // Sprint5Tests í™•ì¸
            const sprint5Tests = window.sprint5Tests;
            log(`Sprint5Tests ì¡´ì¬: ${!!sprint5Tests}`, sprint5Tests ? 'success' : 'error');

            if (sprint5Tests) {
                log(`  - unitTests: ${!!sprint5Tests.unitTests}`, 'info');
                log(`  - scenarioTests: ${!!sprint5Tests.scenarioTests}`, 'info');
                log(`  - runAll: ${typeof sprint5Tests.runAll}`, 'info');
            }
        }

        function checkMethods() {
            log('ë©”ì„œë“œ ìƒì„¸ í™•ì¸...', 'info');

            const scheduleContext = window.scheduleContext;
            if (scheduleContext) {
                const methods = Object.keys(scheduleContext).filter(key => typeof scheduleContext[key] === 'function');
                log(`ScheduleContext ë©”ì„œë“œë“¤: ${methods.join(', ')}`, 'info');

                // createSchedule íŒŒë¼ë¯¸í„° í™•ì¸
                if (scheduleContext.createSchedule) {
                    log(`createSchedule í•¨ìˆ˜ ê¸¸ì´: ${scheduleContext.createSchedule.length} íŒŒë¼ë¯¸í„°`, 'info');
                }
            }

            const buildupContext = window.buildupContext;
            if (buildupContext) {
                const methods = Object.keys(buildupContext).filter(key => typeof buildupContext[key] === 'function');
                log(`BuildupContext ë©”ì„œë“œë“¤: ${methods.join(', ')}`, 'info');
            }
        }

        async function testCreateSchedule() {
            log('createSchedule ì§ì ‘ í…ŒìŠ¤íŠ¸...', 'info');

            const scheduleContext = window.scheduleContext;
            if (!scheduleContext || !scheduleContext.createSchedule) {
                log('createSchedule ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                log('í…ŒìŠ¤íŠ¸ ë¯¸íŒ… ìƒì„± ì‹œë„...', 'info');
                const testMeeting = await scheduleContext.createSchedule({
                    type: 'buildup_project',
                    title: '[Debug] Context Test Meeting',
                    description: 'Context debug tool í…ŒìŠ¤íŠ¸',
                    date: new Date(Date.now() + 60000),
                    startDateTime: new Date(Date.now() + 60000),
                    endDateTime: new Date(Date.now() + 120000),
                    projectId: 'PRJ-TEST',
                    meetingSequence: 'pre_meeting',
                    location: 'Debug Room'
                });

                log(`ë¯¸íŒ… ìƒì„± ì„±ê³µ: ${testMeeting.id}`, 'success');
                log(`ìŠ¤ì¼€ì¤„ ì´ ê°œìˆ˜: ${scheduleContext.schedules?.length || 0}`, 'info');

            } catch (error) {
                log(`ë¯¸íŒ… ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                log(`ì „ì²´ ì˜¤ë¥˜: ${JSON.stringify(error, null, 2)}`, 'error');
            }
        }

        async function runUnitTest() {
            log('ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...', 'info');

            if (window.sprint5Tests && window.sprint5Tests.unitTests) {
                try {
                    const result = await window.sprint5Tests.unitTests.meetingCreation();
                    log(`ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'error');
                } catch (error) {
                    log(`ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            } else {
                log('sprint5Tests.unitTestsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }

        async function runScenarioTest() {
            log('ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...', 'info');

            if (window.sprint5Tests && window.sprint5Tests.scenarioTests) {
                try {
                    const result = await window.sprint5Tests.scenarioTests.basicMeetingToPhase();
                    log(`ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'error');
                } catch (error) {
                    log(`ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            } else {
                log('sprint5Tests.scenarioTestsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ìƒíƒœ í™•ì¸
        window.onload = () => {
            setTimeout(checkContexts, 1000);
        };
    </script>
</body>
</html>