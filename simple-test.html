<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Sprint 5 Test</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .test-section {
            background: #2d2d2d;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover { background: #45a049; }
        .log {
            background: #1a1a1a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Simple Sprint 5 Test</h1>
    <p>URL: <span id="current-url"></span></p>

    <div class="test-section">
        <h3>Step 1: Context í™•ì¸</h3>
        <button class="btn" onclick="checkContexts()">Context ìƒíƒœ í™•ì¸</button>
        <div id="context-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>Step 2: ê°„ë‹¨í•œ ë¯¸íŒ… ìƒì„±</h3>
        <button class="btn" onclick="createSimpleMeeting()">ë¯¸íŒ… ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <div id="meeting-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>Step 3: ì›ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h3>
        <button class="btn" onclick="runOriginalTest()">ì›ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="original-log" class="log"></div>
    </div>

    <script>
        document.getElementById('current-url').textContent = window.location.href;

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            let className = type;
            let prefix = '';

            if (type === 'success') prefix = 'âœ… ';
            else if (type === 'error') prefix = 'âŒ ';
            else if (type === 'warning') prefix = 'âš ï¸  ';
            else prefix = 'â„¹ï¸  ';

            element.innerHTML += `<span class="${className}">[${timestamp}] ${prefix}${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        function checkContexts() {
            const contextLog = document.getElementById('context-log');
            contextLog.innerHTML = '';

            log('context-log', 'Context í™•ì¸ ì‹œì‘...', 'info');

            // ê¸°ë³¸ í™•ì¸
            const hasWindow = typeof window !== 'undefined';
            log('context-log', `Window ê°ì²´: ${hasWindow}`, hasWindow ? 'success' : 'error');

            // ScheduleContext í™•ì¸
            const scheduleContext = window.scheduleContext;
            log('context-log', `ScheduleContext ì¡´ì¬: ${!!scheduleContext}`, scheduleContext ? 'success' : 'error');

            if (scheduleContext) {
                log('context-log', `  schedules ë°°ì—´: ${Array.isArray(scheduleContext.schedules)}`, 'info');
                log('context-log', `  schedules ê¸¸ì´: ${scheduleContext.schedules?.length || 0}`, 'info');
                log('context-log', `  createSchedule íƒ€ì…: ${typeof scheduleContext.createSchedule}`, 'info');
                log('context-log', `  isLoading: ${scheduleContext.isLoading}`, 'info');

                // ë©”ì„œë“œ ëª©ë¡
                const methods = Object.keys(scheduleContext).filter(key =>
                    typeof scheduleContext[key] === 'function'
                );
                log('context-log', `  ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ: ${methods.join(', ')}`, 'info');
            }

            // BuildupContext í™•ì¸
            const buildupContext = window.buildupContext;
            log('context-log', `BuildupContext ì¡´ì¬: ${!!buildupContext}`, buildupContext ? 'success' : 'error');

            if (buildupContext) {
                log('context-log', `  projects ë°°ì—´: ${Array.isArray(buildupContext.projects)}`, 'info');
                log('context-log', `  projects ê¸¸ì´: ${buildupContext.projects?.length || 0}`, 'info');

                // PRJ-TEST í™•ì¸
                const testProject = buildupContext.projects?.find(p => p.id === 'PRJ-TEST');
                log('context-log', `  PRJ-TEST í”„ë¡œì íŠ¸: ${testProject ? 'ì¡´ì¬' : 'ì—†ìŒ'}`, testProject ? 'success' : 'warning');
                if (testProject) {
                    log('context-log', `    PRJ-TEST phase: ${testProject.phase}`, 'info');
                    log('context-log', `    PRJ-TEST meetings: ${testProject.meetings?.length || 0}ê°œ`, 'info');
                }
            }

            // Sprint5Tests í™•ì¸
            const sprint5Tests = window.sprint5Tests;
            log('context-log', `Sprint5Tests ì¡´ì¬: ${!!sprint5Tests}`, sprint5Tests ? 'success' : 'error');
        }

        async function createSimpleMeeting() {
            const meetingLog = document.getElementById('meeting-log');
            meetingLog.innerHTML = '';

            log('meeting-log', 'ê°„ë‹¨í•œ ë¯¸íŒ… ìƒì„± ì‹œì‘...', 'info');

            const scheduleContext = window.scheduleContext;
            if (!scheduleContext) {
                log('meeting-log', 'ScheduleContextë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            if (typeof scheduleContext.createSchedule !== 'function') {
                log('meeting-log', 'createSchedule ë©”ì„œë“œê°€ í•¨ìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤', 'error');
                log('meeting-log', `ì‹¤ì œ íƒ€ì…: ${typeof scheduleContext.createSchedule}`, 'error');
                return;
            }

            const initialCount = scheduleContext.schedules?.length || 0;
            log('meeting-log', `ì´ˆê¸° ìŠ¤ì¼€ì¤„ ìˆ˜: ${initialCount}`, 'info');

            try {
                const meetingData = {
                    type: 'buildup_project',
                    title: '[Simple Test] ê¸°ë³¸ ë¯¸íŒ…',
                    description: 'ê°„ë‹¨ í…ŒìŠ¤íŠ¸',
                    date: new Date(Date.now() + 60000), // 1ë¶„ í›„
                    startDateTime: new Date(Date.now() + 60000),
                    endDateTime: new Date(Date.now() + 120000), // 2ë¶„ í›„
                    projectId: 'PRJ-TEST',
                    meetingSequence: 'pre_meeting',
                    location: 'Test Room'
                };

                log('meeting-log', 'createSchedule í˜¸ì¶œ ì¤‘...', 'info');
                log('meeting-log', `ë°ì´í„°: ${JSON.stringify(meetingData, null, 2)}`, 'info');

                const result = await scheduleContext.createSchedule(meetingData);

                log('meeting-log', 'ë¯¸íŒ… ìƒì„± ì„±ê³µ!', 'success');
                log('meeting-log', `ìƒì„±ëœ ID: ${result?.id}`, 'success');

                const finalCount = scheduleContext.schedules?.length || 0;
                log('meeting-log', `ìµœì¢… ìŠ¤ì¼€ì¤„ ìˆ˜: ${finalCount}`, 'info');
                log('meeting-log', `ì¦ê°€ëŸ‰: ${finalCount - initialCount}`, finalCount > initialCount ? 'success' : 'warning');

            } catch (error) {
                log('meeting-log', 'ë¯¸íŒ… ìƒì„± ì‹¤íŒ¨!', 'error');
                log('meeting-log', `ì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}`, 'error');
                log('meeting-log', `ì˜¤ë¥˜ ìŠ¤íƒ: ${error.stack}`, 'error');

                if (error.cause) {
                    log('meeting-log', `ì›ì¸: ${JSON.stringify(error.cause, null, 2)}`, 'error');
                }
            }
        }

        async function runOriginalTest() {
            const originalLog = document.getElementById('original-log');
            originalLog.innerHTML = '';

            log('original-log', 'ì›ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...', 'info');

            if (!window.sprint5Tests) {
                log('original-log', 'sprint5Testsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            if (!window.sprint5Tests.unitTests) {
                log('original-log', 'unitTestsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            if (!window.sprint5Tests.unitTests.meetingCreation) {
                log('original-log', 'meetingCreation í…ŒìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                log('original-log', 'meetingCreation í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...', 'info');
                const result = await window.sprint5Tests.unitTests.meetingCreation();
                log('original-log', `í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'error');
            } catch (error) {
                log('original-log', 'í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
                log('original-log', `ì˜¤ë¥˜: ${error.message}`, 'error');
                log('original-log', `ìŠ¤íƒ: ${error.stack}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ Context í™•ì¸
        setTimeout(checkContexts, 1000);
    </script>
</body>
</html>