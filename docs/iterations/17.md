# Sprint 17: KPI 진단 통합 페이지 (1주)

> 생성일: 2025-01-10
> 수정일: 2025-01-12
> PRD v4.0 기반
> ⚠️ **업데이트**: 5개 탭에서 3개 탭으로 간소화 (사용성 개선)
> ✅ **완료**: 데이터 영속성 및 히스토리 추적 시스템 구현

## 목표
Assessments와 Results 페이지를 하나의 통합된 KPI 진단 페이지로 재구성 (3탭 구조)

## 배경
- 현재 평가(Assessments)와 결과(Results)가 분리되어 있어 사용자 경험 단절
- PRD v4.0에서 "KPI 진단"으로 통합 제안
- **개선**: 5개 탭이 과도하여 3개 탭으로 간소화 (중복 제거, 사용성 향상)

## 작업 목록

### 1. 페이지 구조 설계 ✅

#### 컴포넌트 구조 (3탭 구조로 간소화)
```tsx
// pages/startup/KPIDiagnosis.tsx
<KPIDiagnosisPage>
  <TabNavigation>
    <Tab name="진단하기" />      // KPI 입력
    <Tab name="결과 & 인사이트" /> // 결과 + 분석 + 벤치마킹 통합
    <Tab name="액션플랜" />       // 실행 계획
  </TabNavigation>
  
  <TabContent>
    {activeTab === '진단하기' && <AssessmentPanel />}
    {activeTab === '결과 & 인사이트' && <ResultsInsightsPanel />}
    {activeTab === '액션플랜' && <ActionPlanPanel />}
  </TabContent>
</KPIDiagnosisPage>
```

### 2. 기존 컴포넌트 마이그레이션 ✅

#### 진단하기 탭 (기존 유지)
- [x] KPI 입력 폼
- [x] 실시간 진행률 표시
- [x] 축별 서브탭 (GO/EC/PT/PF/TO)
- [x] 자동 저장 기능

#### 결과 & 인사이트 탭 (통합)
- [x] **상단**: 종합 점수 카드 + 단계 진행도
- [x] **중단**: 레이더 차트 + Top 3 강점/약점
- [x] **하단**: 축별 개선 잠재력 분석

### 3. 통합/간소화된 탭 구현 ✅

#### 결과 & 인사이트 탭 (신규 통합)
```typescript
interface ResultsInsights {
  // 핵심 지표
  overallScore: number;
  stageProgress: number;
  
  // 시각화
  radarData: RadarData;
  peerComparison: PeerData;
  
  // 분석
  strengths: KPIContribution[];
  weaknesses: KPIContribution[];
  improvementPotential: AxisPotential[];
}
```

- [x] 종합 점수 대시보드
- [x] 5축 레이더 차트 (피어 비교 포함)
- [x] Top 3 강점/약점 자동 추출
- [x] 축별 Quick Win 분석

#### 액션플랜 탭 (포켓컴퍼니 생태계 연결)

**전략**: 가치 제공 우선, 자연스러운 빌드업 프로그램 연결

```typescript
interface ActionPlan {
  // 메타인지
  weaknessInsights: {
    axis: AxisKey;
    severity: 'critical' | 'warning' | 'moderate';
    industryPercentile: number;
    riskDescription: string;
    benchmark: string;
  }[];
  
  // 빌드업 프로그램
  recommendedPrograms: {
    programId: string;
    name: string;
    targetAxis: AxisKey;
    duration: string;
    expectedImprovement: number;
    curriculum: string[];
    successCase: {
      company: string;
      improvement: string;
    };
  }[];
  
  // 전문가 매칭
  expertConsultants: {
    expertId: string;
    name: string;
    expertise: string[];
    experience: string;
    availability: 'immediate' | 'scheduled';
    freeConsultation: boolean; // 구독 회원 혜택
  }[];
  
  // Quick Win 로드맵
  quickWins: {
    phase: number;
    title: string;
    tasks: string[];
    expectedImpact: number;
    difficulty: 'easy' | 'medium' | 'hard';
    timeframe: string;
  }[];
  
  // 성공 사례
  successStories: {
    company: string;
    industry: string;
    beforeScore: number;
    afterScore: number;
    keyChanges: string[];
    programUsed: string;
  }[];
}
```

**구현 우선순위**:
1. [x] **약점 메타인지 섹션**: 
   - 업계 하위 퍼센타일 표시
   - 위험 수준 경고 메시지
   - "당신이 모르는 것" 강조

2. [x] **맞춤형 빌드업 프로그램**: 
   - 약점 축별 최적 프로그램 자동 매칭
   - 예상 개선 효과 시뮬레이션
   - 성공 사례와 연결

3. [x] **전문가 1:1 컨설팅**: 
   - 구독 회원 무제한 상담 강조
   - 즉시 예약 가능한 전문가 표시
   - 30분 무료 진단 제공

4. [x] **Quick Win 로드맵**: 
   - 단계별 실행 계획 (2주/4주/8주)
   - 난이도별 태스크 분류
   - 예상 점수 개선 시각화

5. [x] **성공 사례 벤치마크**: 
   - 동일 업종/단계 기업 사례 (더미 데이터)
   - Before/After 점수 비교
   - 핵심 전환점 스토리텔링

6. [x] **포켓컴퍼니 구독 CTA**: 
   - 첫 달 무료 체험
   - 구독 혜택 명확히 표시
   - 비구독자도 가치 얻을 수 있게 설계

### 4. 상태 관리 통합 ✅

#### Context 재구성
```typescript
interface KPIDiagnosisContext {
  // 진단 데이터
  responses: Record<string, KPIResponse>;
  
  // 계산된 결과
  axisScores: Record<AxisKey, number>;
  overallScore: number;
  
  // 인사이트
  insights: {
    strengths: KPIContribution[];
    weaknesses: KPIContribution[];
    potential: AxisPotential[];
  };
  
  // 액션플랜
  actionItems: ActionItem[];
  
  // 탭 상태 (3개)
  activeTab: '진단하기' | '결과 & 인사이트' | '액션플랜';
  
  // 액션
  updateResponse: (kpiId: string, response: KPIResponse) => void;
  calculateScores: () => void;
  generateActionPlan: () => void;
}
```

### 5. 라우팅 및 리다이렉션 ✅

```tsx
// App.tsx
// 기존 경로 리다이렉션 (3탭 구조)
<Route 
  path="/startup/assessments" 
  element={<Navigate to="/startup/kpi?tab=assess" />} 
/>
<Route 
  path="/startup/results" 
  element={<Navigate to="/startup/kpi?tab=insights" />} 
/>

// 새 경로 (쿼리 파라미터로 탭 제어)
<Route path="/startup/kpi" element={<KPIDiagnosis />} />
// ?tab=assess | insights | action
```

### 6. UX 개선사항 ✅

#### 탭 전환 로직 (3탭 최적화)
- [x] 진단 완료 시 자동으로 '결과 & 인사이트' 탭 이동
- [x] 단순화된 진행 표시 (1→2→3)
- [x] 탭별 완료 상태 아이콘
- [x] 실시간 데이터 동기화

## 기술 구현 사항

### 성능 최적화
```typescript
// 탭별 지연 로딩
const AssessmentPanel = lazy(() => import('./panels/AssessmentPanel'));
const ResultsPanel = lazy(() => import('./panels/ResultsPanel'));

// 메모이제이션
const memoizedResults = useMemo(() => 
  calculateResults(assessmentData), 
  [assessmentData]
);
```

### 데이터 캐싱
```typescript
// localStorage 활용
const CACHE_KEY = 'pocketbiz_kpi_diagnosis';

const saveToCache = (data: DiagnosisData) => {
  localStorage.setItem(CACHE_KEY, JSON.stringify({
    ...data,
    timestamp: Date.now()
  }));
};
```

## 테스트 계획

### 단위 테스트
- [ ] 각 탭 컴포넌트 렌더링
- [ ] 탭 전환 로직
- [ ] 데이터 흐름

### 통합 테스트
- [ ] 진단 → 결과 플로우
- [ ] 리다이렉션 동작
- [ ] 상태 동기화

### 사용자 테스트
- [ ] 탭 구조 직관성
- [ ] 로딩 시간
- [ ] 모바일 사용성

## 완료 기준

### 기능적 요구사항
- [ ] 모든 기존 기능 정상 작동
- [ ] 탭 전환 부드러움 (< 200ms)
- [ ] 데이터 무결성 유지
- [ ] 리다이렉션 정상 작동

### 비기능적 요구사항
- [ ] 페이지 로드 시간 < 2초
- [ ] 메모리 사용량 기존 대비 동일 이하
- [ ] 모바일 반응형 완벽 지원

## 일정

### Day 1-2: 구조 설계 및 셋업
- 페이지 구조 생성
- 라우팅 설정
- Context 구성

### Day 3-4: 컴포넌트 마이그레이션
- Assessments 이동
- Results 이동
- 상태 연결

### Day 5-6: 신규 탭 구현
- 상세 분석
- 벤치마킹
- 액션 플랜

### Day 7: 테스트 및 최적화
- 버그 수정
- 성능 최적화
- 사용자 테스트

## 리스크 및 대응

### 기술적 리스크
- **상태 관리 복잡도**: Context 분리 고려
- **성능 저하**: 코드 스플리팅 적용
- **데이터 동기화**: 중앙 상태 관리 강화

### UX 리스크
- **탭 구조 혼란**: 온보딩 툴팁 추가
- **모바일 경험**: 별도 모바일 뷰 고려

## 연관 작업
- Sprint 4: KPI 입력 시스템
- Sprint 5: 결과 시각화
- iteration-16: 전체 사용자 환경 고도화

## 2025-01-12 업데이트 내용

### ✅ 완료된 작업

#### 1. 데이터 영속성 구현
- **진단 결과 히스토리 저장 시스템**
  - `diagnosticHistory.ts` 유틸리티 생성
  - localStorage 기반 영속성 구현
  - 최대 52주(1년) 데이터 보관
  - 진단 완료율 80% 이상 시 자동 스냅샷 저장

#### 2. 변화 추적 시스템
- **주간/월간 변화 추적**
  - 이전 진단 대비 종합 점수 변화 표시
  - 축별 변화량 계산 및 시각화
  - 월간 트렌드 데이터 생성 (최근 6개월)

#### 3. 비교 기능
- **이전 결과와 비교**
  - 레이더 차트 하단에 축별 변화 표시
  - 종합 점수 카드에 주간 변화 표시
  - 개선/악화 시각적 표현 (색상, 아이콘)

#### 4. 시계열 분석 (간단한 버전)
- **성장 트렌드 섹션**
  - 월별 점수를 카드 형태로 표시
  - 변화량 표시 (TrendingUp/Down 아이콘)
  - 2회 이상 진단 시 트렌드 표시

#### 5. 피어 데이터 처리
- **하드코딩 데이터 유지**
  - TODO 주석 추가 (실제 데이터 필요성 명시)
  - 모수 부족 설명 추가
  - 추후 실제 데이터 교체 계획 명시

### 📝 구현 상세

#### 새로 생성된 파일
- `src/utils/diagnosticHistory.ts`: 히스토리 관리 유틸리티

#### 수정된 파일
- `src/contexts/KPIDiagnosisContext.tsx`: 히스토리 시스템 통합
- `src/pages/startup/kpi-tabs/ResultsInsightsPanel.tsx`: 
  - 시계열 트렌드 섹션 추가
  - 축별 변화 표시 추가
  - 피어 데이터 주석 보강

### 🚫 제외된 기능
- CSV 내보내기 기능 (요청에 따라 삭제)
- 피어 그룹 실제 데이터 (모수 부족으로 하드코딩 유지)
- 성공사례 실제 데이터 (더미데이터 유지)